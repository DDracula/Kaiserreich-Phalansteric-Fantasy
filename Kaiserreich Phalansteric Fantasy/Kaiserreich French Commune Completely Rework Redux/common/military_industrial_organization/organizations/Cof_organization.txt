FRA_phalanstere_reasearch_organization = {
    icon = GFX_dynamic_modifier_Cof_phalanstere
	background = GFX_MIO_details_background_plane
    allowed = { always = yes }
    visible = { 
		FROM = { 
			OR = {
				FRA_is_phalanstere_member = yes 
				tag = FRA
			}	
		} 
	} 
    equipment_type = {
        convoy_1
		support_equipment
		train_equipment
		nuclear_missile
    }
    research_categories = {
        train_tech
        electronics
        rocketry
        nuclear
        industry
    }
    ai_will_do = { base = 0 }
	on_tech_research_completed = { FROM = { mio:FRA_phalanstere_reasearch_organization = { add_mio_funds = 200 } } }
    initial_trait = {
        name = FRA_phalanstere_reasearch_organization_trait
        organization_modifier = {
			military_industrial_organization_research_bonus = 0.05
			military_industrial_organization_design_team_assign_cost = 3
		}
		equipment_bonus = {
			build_cost_ic = -0.05
		}
    }
	trait = {
		token = mio_phalanstere_industry_investment_factory
		name = mio_phalanstere_industry_investment_factory
		icon = GFX_generic_mio_department_icon_facilities
		position = { x = 0 y = 0 }
		available = { FROM = { num_of_civilian_factories_available_for_projects > 5 } }
		mutually_exclusive = { mio_phalanstere_industry_investment_construction }
		on_complete = {
			FROM = { 
				set_temp_variable = { phauc = 2.5 }
		        phalanstere_unity_change = yes
				custom_effect_tooltip = {
					localization_key = tooltip_modify_dynmod
					DYNMOD = Cof_phalanstere
				}
				custom_effect_tooltip = tooltip_white_line
				add_to_variable = {
					INT_civilian_factory_use = 5
					tooltip = civilian_factory_use_tt
				}
			}
		}
		organization_modifier = {
			military_industrial_organization_funds_gain = 0.1
		}
	}
	trait = {
		token = mio_phalanstere_industry_investment_construction
		name = mio_phalanstere_industry_investment_construction
		icon = GFX_generic_mio_department_icon_facilities
		position = { x = 2 y = 0 }
		mutually_exclusive = { mio_phalanstere_industry_investment_factory }
		available = { FROM = { has_political_power > 100 } }
		on_complete = {
			FROM = { 
				add_political_power = -100
				set_temp_variable = { phauc = 2.5 }
		        phalanstere_unity_change = yes
				custom_effect_tooltip = {
					localization_key = tooltip_modify_dynmod
					DYNMOD = Cof_phalanstere
				}
				custom_effect_tooltip = tooltip_white_line
				add_to_variable = {
					INT_production_speed_industrial_complex_factor = -0.1
					tooltip = production_speed_industrial_complex_factor_tt
				}
			}
		}
		organization_modifier = {
			military_industrial_organization_design_team_assign_cost = -1
		}
	}
	trait = {
		token = mio_phalanstere_industry_investment_get_back
		name = mio_phalanstere_industry_investment_get_back
		icon = GFX_generic_mio_department_icon_facilities
		position = { x = 1 y = 1 }
		available = {
			custom_trigger_tooltip = {
				tooltip = {
					localization_key = phalanstere_agree_about_what
					COOPROJECT = FRA_revolutionary_aid_construction
				}
				FRA = { has_country_flag = phalanstere_agree_about_revolutionary_aid_construction }
			}
		}
		any_parent = {
			mio_phalanstere_industry_investment_factory
			mio_phalanstere_industry_investment_construction
		}
		on_complete = {
			FROM = { 
				custom_effect_tooltip = phalanstere_industry_tooltip
			}
		}
		organization_modifier = {
			military_industrial_organization_research_bonus = 0.05
		}
	}

	trait = {
		token = mio_phalanstere_volunteer_train
		name = mio_phalanstere_volunteer_train
		icon = GFX_generic_mio_department_icon_infantry_quality
		position = { x = 6 y = 1 }
		available = {
			FRA = { has_completed_focus = FRA_revolutionary_bases_abroad }
			FROM = {
				NOT = { tag = FRA }
				custom_trigger_tooltip = {
					tooltip = capital_already_has_revo_bases
					capital_scope = { NOT = { has_dynamic_modifier = { modifier = Cof_revolutionary_bases scope = THIS.id } } }
				}
				set_temp_variable = { target_num = 5 }
				custom_trigger_tooltip = {
					tooltip = judge_num_of_voluteers_more_than_x
					check_variable = { num_of_volunteers > target_num }
				}
			}
		}
		on_complete = {
			FROM = { 
				set_temp_variable = { phauc = 2.5 }
				phalanstere_unity_change = yes
				custom_effect_tooltip = tooltip_white_line
				capital_scope = { add_dynamic_modifier = { modifier = Cof_revolutionary_bases scope = THIS.id } } 
				hidden_effect = { 
					add_ideas = Cof_revolutionary_bases_buff 
					FRA = {
						if = {
							limit = { capital_scope = { INT_is_in_europe = yes } } 
							set_temp_variable = { iri_euic = 5 }
						}
						else = { set_temp_variable = { iri_euic = 0 } }

						if = {
							limit = { capital_scope = { INT_is_in_asia = yes } } 
							set_temp_variable = { iri_asic = 5 }
						}
						else = { set_temp_variable = { iri_asic = 0 } }

						if = {
							limit = { capital_scope = { INT_is_in_middle_east = yes } }
							set_temp_variable = { iri_meic = 5 }
						}
						else = { set_temp_variable = { iri_meic = 0 } }

						if = {
							limit = { capital_scope = { INT_is_in_africa = yes } }
							set_temp_variable = { iri_afic = 5 }
						}
						else = { set_temp_variable = { iri_afic = 0 } }

						if = {
							limit = { capital_scope = { INT_is_in_america = yes } }
							set_temp_variable = { iri_amic = 5 }
						}
						else = { set_temp_variable = { iri_amic = 0 } }
						iri_influence_change = yes
					}
				}
			}
		}
		limit_to_equipment_type = { support_equipment }
		equipment_bonus = {
			build_cost_ic = -0.05
			reliability = 0.05
		}
	}

	trait = {
		token = mio_phalanstere_active_foreign_trade
		name = mio_phalanstere_active_foreign_trade
		icon = GFX_generic_mio_trait_icon_production_capacity
		position = { x = 2 y = 1 }
		available = {
			custom_trigger_tooltip = {
				tooltip = {
					localization_key = phalanstere_agree_about_what
					COOPROJECT = FRA_inner_circle_of_socialism
				}
				FRA = { has_country_flag = phalanstere_agree_about_inner_circle_of_socialism }
			}	
			FROM = {
				OR = {
					has_equipment = { convoy_1 > 49 }
					has_equipment = { train_equipment > 9 }
				}
			}
		}
		on_complete = {
			FROM = { 
				effect_tooltip = {
					custom_effect_tooltip = if_has_convoy_50
					add_equipment_to_stockpile = { 
						type = convoy_1
						amount = -50
					}
					custom_effect_tooltip = if_has_train_10
					add_equipment_to_stockpile = { 
						type = train_equipment
						amount = -10
					}
				}

				custom_effect_tooltip = tooltip_white_line
				set_temp_variable = { phauc = 2.5 }
		        phalanstere_unity_change = yes
				custom_effect_tooltip = {
					localization_key = tooltip_modify_dynmod
					DYNMOD = Cof_phalanstere
				}
				custom_effect_tooltip = tooltip_white_line
				add_to_variable = {
					INT_cic_construction_boost_factor = 0.25
					tooltip = cic_construction_boost_factor_tt
				}
				hidden_effect = {
					if = {
						limit = { has_equipment = { convoy_1 > 49 } }
						add_equipment_to_stockpile = { 
							type = convoy_1
							amount = -50
						}
					}
					else = {
						add_equipment_to_stockpile = { 
							type = train_equipment
							amount = -10
						}
					}
				}
			}
		}
		limit_to_equipment_type = { convoy_1 }
		equipment_bonus = {
			build_cost_ic = -0.1
		}
	}

	trait = {
		token = mio_phalanstere_reasearch_investment
		name = mio_phalanstere_reasearch_investment
		icon = GFX_generic_mio_trait_icon_unique
		position = { x = 4 y = 0 }
		available = {
			FROM = { has_political_power > 50 }
		}
		on_complete = {
			FROM = { 
				add_political_power = -50
				custom_effect_tooltip = reasearch_investment_tooltip
				add_to_variable = { global.pha_reasearch_investment = 1 }
				hidden_effect = {
					set_temp_variable = { t = global.pha_reasearch_investment }
					modulo_temp_variable = { t = 10 }
					set_temp_variable = { numt = global.pha_reasearch_investment }
					subtract_from_temp_variable = { numt = t }
					multiply_temp_variable = { numt = 0.1 }
					if = {
						limit = { check_variable = { numt > global.pha_reasearch_slot } }
						add_research_slot = 1
						add_to_variable = { global.pha_reasearch_slot = 1 }
					}
				}
			}
		}
		organization_modifier = {
			military_industrial_organization_research_bonus = 0.05
			military_industrial_organization_design_team_assign_cost = 0.5
		}
	}
	trait = {
		token = mio_phalanstere_reasearch_laboratory
		name = mio_phalanstere_reasearch_laboratory
		icon = GFX_generic_mio_trait_icon_unique
		position = { x = 4 y = 1 }
		all_parents = { mio_phalanstere_reasearch_investment } 
		available = {
			custom_trigger_tooltip = {
				tooltip = {
					localization_key = phalanstere_agree_about_what
					COOPROJECT = FRA_international_open_laboratory
				}
				FRA = { has_country_flag = phalanstere_agree_about_international_open_laboratory }
			}	
		}
		on_complete = {
			FROM = { 
				
			}
		}
		organization_modifier = {
			military_industrial_organization_research_bonus = 0.1
			military_industrial_organization_design_team_assign_cost = 0.5
		}
	}

	
}

######从这里开始添加（不要删除此条）######新的MIO
